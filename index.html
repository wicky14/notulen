<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notulen AGV</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        /* --- CSS PREVIEW PDF (Ukuran A4 Presisi) --- */
        @import url('https://fonts.googleapis.com/css2?family=Arimo:wght@400;700&display=swap');

        /* Lebar standar A4 di 96 DPI (794px) */
        .a4-page {
            width: 794px; /* Didefinisikan dalam piksel untuk memastikan panning di HP */
            min-height: 1123px; 
            padding: 10mm 15mm;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 15px rgba(0,0,0,0.15);
            font-family: 'Arimo', Arial, sans-serif;
            font-size: 10pt;
            color: black;
            position: relative;
            box-sizing: border-box;
            page-break-after: always;
        }
        
        /* Kontainer Utama PDF yang akan di-scale */
        #pdf-content {
            transform-origin: top center; 
            transition: transform 0.2s ease-out; 
        }
        
        /* Styling Tabel Dokumen */
        .doc-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .doc-table th, .doc-table td {
            border: 1px solid black;
            padding: 4px 6px;
            vertical-align: top;
        }
        .doc-table th {
            background-color: #f3f4f6;
            text-align: center;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 9pt;
        }

        /* Styling elemen lainnya tetap sama */
        .header-container {
            display: grid;
            grid-template-columns: 20% 55% 25%;
            border-bottom: 2px solid black;
            padding-bottom: 8px;
            margin-bottom: 12px;
            align-items: center;
        }
        .header-logo-container {
            text-align: left;
            padding-right: 5px; 
        }
        .header-logo-container img {
            max-height: 50px; 
            width: auto;
            display: block;
        }
        .header-center {
            text-align: center;
        }
        .header-center h1 { font-size: 11pt; font-weight: bold; margin: 0; }
        .header-center h2 { font-size: 10pt; font-weight: bold; margin: 0; }
        .header-center h3 { font-size: 11pt; font-weight: bold; text-decoration: underline; margin-top: 4px; }
        .header-meta table {
            width: 100%;
            font-size: 8pt;
            border-collapse: collapse;
        }
        .header-meta td {
            border: none;
            padding: 1px 2px;
        }
        .header-meta tr td:first-child { 
            font-weight: bold; 
            width: 60px; 
            white-space: nowrap; 
        }
        .info-section {
            display: table;
            width: 100%;
            margin-bottom: 10px;
        }
        .info-row { display: table-row; }
        .info-label { display: table-cell; width: 100px; font-weight: normal; padding: 2px 0; }
        .info-sep { display: table-cell; width: 10px; padding: 2px 0; }
        .info-val { display: table-cell; font-weight: normal; padding: 2px 0; }
        .footer-sign {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding: 0 30px;
            page-break-inside: avoid;
        }
        .sign-box {
            text-align: center;
            width: 200px;
        }
        .sign-gap { height: 60px; }
        .sign-name { font-weight: bold; text-decoration: underline; }
        [x-cloak] { display: none !important; }

        /* --- CSS Responsif (Khusus Layout) --- */
        
        /* Layout untuk PC/Desktop (>= 1024px) */
        @media (min-width: 1024px) { 
            .layout-container {
                display: flex;
                height: 100%;
            }
            .sidebar-input {
                width: var(--sidebar-width, 380px); 
                flex-shrink: 0;
                overflow-y: auto; 
            }
            .content-preview {
                flex-grow: 1;
                overflow-y: auto;
                padding: 1rem;
                padding-top: 1rem; /* Kurangi padding atas karena zoom controls hilang */
            }
            .bottom-bar {
                display: none !important; 
            }
            .resizer {
                width: 8px;
                cursor: ew-resize; 
                background-color: #4b5563; 
                flex-shrink: 0; 
                z-index: 30; 
            }
        }

        /* Layout untuk Mobile/Tablet (< 1024px) */
        @media (max-width: 1023px) { 
            .layout-container {
                flex-direction: column;
                height: 100%;
                overflow: hidden;
            }
            .sidebar-input, .content-preview {
                width: 100%;
                max-height: calc(100vh - 56px); 
                overflow-y: auto;
                padding-bottom: 2rem; 
                transition: transform 0.3s ease-in-out;
            }
            
            .sidebar-input.hidden-mobile {
                 display: none;
            }
            .content-preview.hidden-mobile {
                 display: none;
            }
            
            .bottom-bar {
                position: fixed;
                bottom: 0;
                left: 0;
                width: 100%;
                z-index: 50;
                height: 56px; 
            }
            
            /* Hapus override A4-page, biarkan width: 794px agar scrollable */
            .a4-page {
                box-shadow: none;
            }
            /* Hapus margin/transform yang tidak perlu di mobile */
            #pdf-content {
                margin: 0 !important; 
                transform: none !important;
            }
        }
        
        /* --- CSS PRINT (Cetak ke PDF/Printer) --- */
        @media print {
            .sidebar-input, .bottom-bar, .resizer, .zoom-controls { 
                display: none !important; 
            }
            .layout-container, .content-preview {
                width: 100%;
                max-width: none;
                margin: 0;
                padding: 0;
                box-shadow: none;
                overflow: visible !important;
            }
            #pdf-content {
                transform: none !important;
                margin: 0 !important;
            }
            .a4-page {
                width: 210mm !important; /* Gunakan mm saat cetak */
                box-shadow: none !important;
                margin: 0 !important;
                padding: 10mm 15mm !important;
                min-height: auto !important;
                page-break-after: always;
            }
            
            body {
                overflow: visible !important;
                background: white !important;
            }
            
            .a4-page img {
                max-width: 100% !important;
                height: auto !important;
                display: block !important;
                object-fit: initial !important; 
            }

            @page {
                size: A4;
                margin: 0; 
            }
        }
    </style>
</head>

<body class="bg-gray-100 h-screen overflow-hidden text-gray-800" x-data="appData()" x-init="initData()" x-on:resize.window="handleResize()">

    <div class="layout-container h-full">
        
        <div class="sidebar-input bg-white h-full flex flex-col shadow-xl z-20 border-r border-gray-200"
             x-ref="sidebar"
             :class="{ 'hidden-mobile': activeTab !== 'input' && window.innerWidth < 1024 }">
            
            <div class="p-4 bg-gray-900 text-white shadow-md flex justify-between items-center shrink-0">
                <h1 class="font-bold text-lg tracking-wide">Notulen AGV</h1>
                <div class="flex space-x-2">
                    
                    <label for="importFile" class="bg-yellow-600 hover:bg-yellow-500 text-white p-2 rounded shadow transition cursor-pointer" title="Import Data">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>
                        <input type="file" id="importFile" @change="importData" class="hidden" accept=".json">
                    </label>

                    <button @click="exportData" class="bg-blue-600 hover:bg-blue-500 text-white p-2 rounded shadow transition" title="Export Draft">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" /></svg>
                    </button>
                    
                    <button @click="generatePDF" class="bg-red-600 hover:bg-red-500 text-white p-2 rounded shadow transition" title="Print to PDF (Save as PDF)">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2z" /></svg>
                    </button>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto p-4 space-y-6 bg-gray-50">
                <div class="bg-white p-3 rounded shadow-sm border border-gray-200">
                    <h3 class="font-bold text-gray-700 text-sm mb-3 border-b pb-1">Info Dokumen</h3>
                    <div class="grid grid-cols-1 gap-2">
                        <div><label class="text-xs text-gray-500">No. Dokumen</label><input x-model="doc.no" class="w-full border p-1 rounded text-sm"></div>
                        <div><label class="text-xs text-gray-500">Tgl Berlaku</label><input x-model="doc.tgl" class="w-full border p-1 rounded text-sm"></div>
                        <div><label class="text-xs text-gray-500">Revisi</label><input x-model="doc.rev" class="w-full border p-1 rounded text-sm"></div>
                    </div>
                </div>

                <div class="bg-white p-3 rounded shadow-sm border border-gray-200">
                    <h3 class="font-bold text-gray-700 text-sm mb-3 border-b pb-1">Detail Rapat</h3>
                    <div class="space-y-2">
                        <div><label class="text-xs text-gray-500">Tanggal</label><input type="date" x-model="meet.date" class="w-full border p-1 rounded text-sm"></div>
                        <div><label class="text-xs text-gray-500">Waktu</label><input x-model="meet.time" class="w-full border p-1 rounded text-sm" placeholder="Contoh: 20.00-22.00"></div>
                        <div><label class="text-xs text-gray-500">Tempat</label><input x-model="meet.place" class="w-full border p-1 rounded text-sm"></div>
                        <div><label class="text-xs text-gray-500">Agenda</label><input x-model="meet.agenda" class="w-full border p-1 rounded text-sm"></div>
                    </div>
                </div>

                <div class="bg-white p-3 rounded shadow-sm border border-gray-200">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="font-bold text-gray-700 text-sm">Pembahasan</h3>
                        <button @click="addItem" class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded hover:bg-green-200 font-bold">+ Item</button>
                    </div>
                    <div class="space-y-3">
                        <template x-for="(item, index) in items" :key="index">
                            <div class="border p-2 rounded bg-gray-50 relative">
                                <button @click="removeItem(index)" class="absolute top-1 right-1 text-red-400 hover:text-red-600 text-lg leading-none">&times;</button>
                                <input x-model="item.topic" placeholder="Judul Pembahasan" class="w-full border-b bg-transparent p-1 text-sm font-bold mb-1 focus:outline-none">
                                <textarea x-model="item.detail" placeholder="Detail Tindak Lanjut..." class="w-full border p-1 text-sm h-16 rounded mb-1"></textarea>
                                <div class="flex gap-2">
                                    <input x-model="item.pic" placeholder="PIC" class="w-1/2 border p-1 text-xs rounded">
                                    <input type="date" x-model="item.due" placeholder="Due Date" class="w-1/2 border p-1 text-xs rounded">
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <div class="bg-white p-3 rounded shadow-sm border border-gray-200">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="font-bold text-gray-700 text-sm">Daftar Hadir</h3>
                        <button @click="addAttendee" class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded hover:bg-blue-200 font-bold">+ Peserta</button>
                    </div>
                    <div class="space-y-1">
                        <template x-for="(p, i) in attendees" :key="i">
                            <div class="flex gap-1 items-center">
                                <span x-text="i+1+'.'" class="text-xs w-4 text-gray-400"></span>
                                <input x-model="p.name" placeholder="Nama" class="w-1/2 border p-1 text-xs rounded">
                                <input x-model="p.address" placeholder="Blok/No" class="w-1/3 border p-1 text-xs rounded">
                                <button @click="removeAttendee(i)" class="text-red-400 hover:bg-red-50 rounded px-1">&times;</button>
                            </div>
                        </template>
                    </div>
                </div>

                <div class="bg-white p-3 rounded shadow-sm border border-gray-200">
                    <h3 class="font-bold text-gray-700 text-sm mb-2">Dokumentasi</h3>
                    <input type="file" multiple @change="handlePhotos" class="text-xs w-full mb-2" accept="image/*">
                    <p class="text-xs text-gray-500 mb-2">Foto akan di kompres otomatis saat diunggah untuk menghindari kegagalan Print ke PDF.</p>
                    <div class="grid grid-cols-3 gap-2">
                        <template x-for="(photo, idx) in photos" :key="idx">
                            <div class="relative group aspect-square">
                                <img :src="photo" class="w-full h-full object-cover rounded border">
                                <button @click="removePhoto(idx)" class="absolute top-0 right-0 bg-red-600 text-white w-5 h-5 flex items-center justify-center text-xs opacity-100 rounded-bl">&times;</button>
                            </div>
                        </template>
                    </div>
                </div>

                <div class="bg-white p-3 rounded shadow-sm border border-gray-200 pb-8">
                    <h3 class="font-bold text-gray-700 text-sm mb-3 border-b pb-1">Penandatangan</h3>
                    <div class="space-y-3">
                        <div>
                            <label class="text-xs font-bold text-gray-500">Ketua Paguyuban</label>
                            <input x-model="signer.ketua" class="w-full border p-1 rounded text-sm">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500">Notulis</label>
                            <input x-model="signer.notulis_nama" class="w-full border p-1 rounded text-sm mb-1" placeholder="Nama">
                            <input x-model="signer.notulis_jabatan" class="w-full border p-1 rounded text-sm" placeholder="Jabatan (mis: Kominfo)">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="resizer hidden lg:block" x-on:mousedown="startResize($event)" x-ref="resizer"></div>

        <div class="content-preview bg-gray-700 flex justify-center relative"
             x-ref="previewContainer"
             :class="{ 'hidden-mobile': activeTab !== 'preview' && window.innerWidth < 1024 }">
            
            <div class="zoom-controls hidden space-x-2 p-2 bg-gray-900/90 rounded-b-lg shadow-xl absolute top-0 z-30 justify-center">
                <button @click="adjustZoom(-0.1)" class="bg-gray-700 text-white p-2 rounded hover:bg-gray-600" title="Zoom Out">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" /></svg>
                </button>
                
                <span x-text="`${Math.round(zoomLevel * 100)}%`" class="text-white text-lg font-bold p-2 min-w-[70px] text-center"></span>

                <button @click="adjustZoom(0.1)" class="bg-gray-700 text-white p-2 rounded hover:bg-gray-600" title="Zoom In">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                </button>
                
                <button @click="fitToScreen" class="bg-blue-600 text-white p-2 rounded hover:bg-blue-500" title="Fit to Screen">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5" /></svg>
                </button>
            </div>


            <div id="pdf-content" 
                 :style="window.innerWidth >= 1024 ? `transform: scale(${zoomLevel}); margin-top: ${100 / zoomLevel}px; margin-bottom: ${100 / zoomLevel}px;` : ''"
                 class="py-4">
                
                <div class="a4-page">
                    <div class="header-container">
                        <div class="header-logo-container">
                            <img src="https://raw.githubusercontent.com/wicky14/notulen/main/AGV%20Logo.png" alt="Logo Paguyuban Ahsana Green Village">
                        </div>
                        <div class="header-center">
                            <h1>PAGUYUBAN AHSANA GREEN VILLAGE</h1>
                            <h2>KEPENGURUSAN 2024-2026</h2>
                            <h3>NOTULEN RAPAT</h3>
                        </div>
                        <div class="header-meta">
                            <table>
                                <tr><td>No. Dok</td><td>: <span x-text="doc.no"></span></td></tr>
                                <tr><td>Tgl. Berlaku</td><td>: <span x-text="doc.tgl"></span></td></tr>
                                <tr><td>No. Revisi</td><td>: <span x-text="doc.rev"></span></td></tr>
                                <tr><td>Halaman</td><td>: 1</td></tr>
                            </table>
                        </div>
                    </div>

                    <div class="info-section">
                        <div class="info-row"><div class="info-label">Tanggal</div><div class="info-sep">:</div><div class="info-val" x-text="formatDate(meet.date)"></div></div>
                        <div class="info-row"><div class="info-label">Waktu</div><div class="info-sep">:</div><div class="info-val" x-text="meet.time"></div></div>
                        <div class="info-row"><div class="info-label">Tempat</div><div class="info-sep">:</div><div class="info-val" x-text="meet.place"></div></div>
                        <div class="info-row"><div class="info-label">Agenda</div><div class="info-sep">:</div><div class="info-val" x-text="meet.agenda"></div></div>
                    </div>

                    <table class="doc-table">
                        <thead>
                            <tr>
                                <th style="width: 5%">NO.</th>
                                <th style="width: 25%">ITEM PEMBAHASAN</th>
                                <th style="width: 40%">TINDAK LANJUT</th>
                                <th style="width: 15%">PIC</th>
                                <th style="width: 15%">DUE DATE</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="(item, i) in items" :key="i">
                                <tr>
                                    <td class="text-center" x-text="i + 1"></td>
                                    <td class="font-bold" x-text="item.topic"></td>
                                    <td style="white-space: pre-wrap;" x-text="item.detail"></td>
                                    <td class="text-center" x-text="item.pic"></td>
                                    <td class="text-center" x-text="formatDate(item.due)"></td>
                                </tr>
                            </template>
                            <tr x-show="items.length === 0"><td colspan="5" class="text-center text-gray-400 italic py-4">Belum ada item pembahasan</td></tr>
                        </tbody>
                    </table>

                    <div class="footer-sign">
                        <div class="sign-box">
                            <p>Disetujui oleh:</p>
                            <div class="sign-gap"></div>
                            <p class="sign-name" x-text="signer.ketua"></p>
                            <p>Ketua Paguyuban AGV 2024-2026</p>
                        </div>
                        <div class="sign-box">
                            <p>Dibuat oleh:</p>
                            <div class="sign-gap"></div>
                            <p class="sign-name" x-text="signer.notulis_nama"></p>
                            <p x-text="signer.notulis_jabatan"></p>
                            <p>Notulis</p>
                        </div>
                    </div>
                </div>

                <div class="a4-page">
                    <div class="header-container">
                        <div class="header-logo-container">
                            <img src="https://raw.githubusercontent.com/wicky14/notulen/main/AGV%20Logo.png" alt="Logo Paguyuban Ahsana Green Village">
                        </div>
                        <div class="header-center">
                            <h1>PAGUYUBAN AHSANA GREEN VILLAGE</h1>
                            <h2>KEPENGURUSAN 2024-2026</h2>
                            <h3>DAFTAR HADIR</h3>
                        </div>
                        <div class="header-meta">
                            <table>
                                <tr><td>No. Dok</td><td>: <span x-text="doc.no"></span></td></tr>
                                <tr><td>Tgl. Berlaku</td><td>: <span x-text="doc.tgl"></span></td></tr>
                                <tr><td>No. Revisi</td><td>: <span x-text="doc.rev"></span></td></tr>
                                <tr><td>Halaman</td><td>: 2</td></tr>
                            </table>
                        </div>
                    </div>

                    <div class="info-section">
                        <div class="info-row"><div class="info-label">Tanggal</div><div class="info-sep">:</div><div class="info-val" x-text="formatDate(meet.date)"></div></div>
                        <div class="info-row"><div class="info-label">Waktu</div><div class="info-sep">:</div><div class="info-val" x-text="meet.time"></div></div>
                        <div class="info-row"><div class="info-label">Tempat</div><div class="info-sep">:</div><div class="info-val" x-text="meet.place"></div></div>
                        <div class="info-row"><div class="info-label">Agenda</div><div class="info-sep">:</div><div class="info-val" x-text="meet.agenda"></div></div>
                    </div>

                    <table class="doc-table">
                        <thead>
                            <tr>
                                <th style="width: 10%">NO</th>
                                <th style="width: 40%">NAMA</th>
                                <th style="width: 30%">ADDRESS</th>
                                <th style="width: 20%">KEHADIRAN</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="(p, i) in attendees" :key="i">
                                <tr>
                                    <td class="text-center" x-text="i + 1"></td>
                                    <td x-text="p.name"></td>
                                    <td class="text-center" x-text="p.address"></td>
                                    <td class="text-center">Hadir</td>
                                </tr>
                            </template>
                        </tbody>
                    </table>

                    <div class="footer-sign">
                        <div class="sign-box">
                            <p>Disetujui oleh:</p>
                            <div class="sign-gap"></div>
                            <p class="sign-name" x-text="signer.ketua"></p>
                            <p>Ketua Paguyuban AGV 2024-2026</p>
                        </div>
                        <div class="sign-box">
                            <p>Dibuat oleh:</p>
                            <div class="sign-gap"></div>
                            <p class="sign-name" x-text="signer.notulis_nama"></p>
                            <p x-text="signer.notulis_jabatan"></p>
                            <p>Notulis</p>
                        </div>
                    </div>
                </div>

                <div class="a4-page">
                    <div class="header-container">
                        <div class="header-logo-container">
                            <img src="https://raw.githubusercontent.com/wicky14/notulen/main/AGV%20Logo.png" alt="Logo Paguyuban Ahsana Green Village">
                        </div>
                        <div class="header-center">
                            <h1>PAGUYUBAN AHSANA GREEN VILLAGE</h1>
                            <h2>KEPENGURUSAN 2024-2026</h2>
                            <h3>DOKUMENTASI</h3>
                        </div>
                        <div class="header-meta">
                            <table>
                                <tr><td>No. Dok</td><td>: <span x-text="doc.no"></span></td></tr>
                                <tr><td>Tgl. Berlaku</td><td>: <span x-text="doc.tgl"></span></td></tr>
                                <tr><td>No. Revisi</td><td>: <span x-text="doc.rev"></span></td></tr>
                                <tr><td>Halaman</td><td>: 3</td></tr>
                            </table>
                        </div>
                    </div>

                    <div class="info-section">
                        <div class="info-row"><div class="info-label">Hari/Tanggal</div><div class="info-sep">:</div><div class="info-val" x-text="formatDate(meet.date)"></div></div>
                        <div class="info-row"><div class="info-label">Waktu</div><div class="info-sep">:</div><div class="info-val" x-text="meet.time"></div></div>
                        <div class="info-row"><div class="info-label">Tempat</div><div class="info-sep">:</div><div class="info-val" x-text="meet.place"></div></div>
                        <div class="info-row"><div class="info-label">Agenda</div><div class="info-sep">:</div><div class="info-val" x-text="meet.agenda"></div></div>
                    </div>

                    <div class="mt-6 grid grid-cols-3 gap-3">
                        <template x-for="photo in photos">
                            <div class="border p-1 bg-white shadow-sm aspect-video flex justify-center items-center overflow-hidden">
                                <img :src="photo" class="w-full h-auto object-contain">
                            </div>
                        </template>
                        <div x-show="photos.length === 0" class="text-gray-400 italic border border-dashed border-gray-300 w-full text-center py-10 col-span-3">
                            Tidak ada dokumentasi.
                        </div>
                    </div>

                    <div class="footer-sign mt-10">
                        <div class="sign-box">
                            <p>Disetujui oleh:</p>
                            <div class="sign-gap"></div>
                            <p class="sign-name" x-text="signer.ketua"></p>
                            <p>Ketua Paguyuban AGV 2024-2026</p>
                        </div>
                        <div class="sign-box">
                            <p>Dibuat oleh:</p>
                            <div class="sign-gap"></div>
                            <p class="sign-name" x-text="signer.notulis_nama"></p>
                            <p x-text="signer.notulis_jabatan"></p>
                            <p>Notulis</p>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        
        <div class="bottom-bar bg-white border-t border-gray-300 shadow-2xl flex justify-around items-center">
            
            <button @click="activeTab = 'input'" 
                    class="flex flex-col items-center p-2 text-sm transition"
                    :class="{'text-blue-600 font-bold': activeTab === 'input', 'text-gray-500': activeTab !== 'input'}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                Input Data
            </button>
            
            <button @click="activeTab = 'preview'" 
                    class="flex flex-col items-center p-2 text-sm transition"
                    :class="{'text-blue-600 font-bold': activeTab === 'preview', 'text-gray-500': activeTab !== 'preview'}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>
                Preview PDF
            </button>
            
        </div>
    </div>

    <script>
        function appData() {
            return {
                activeTab: window.innerWidth < 1024 ? 'input' : 'input', 
                
                // State untuk Zoom (Logika ini tetap dipertahankan)
                zoomLevel: 1.0, 
                A4_WIDTH_PX: 794, 
                
                // State untuk Resizer
                isResizing: false,
                startWidth: 380, 
                startX: 0, 

                doc: {
                    no: 'F-AGV-01',
                    tgl: '25 Februari 2024',
                    rev: '00'
                },
                meet: {
                    date: new Date().toISOString().split('T')[0], 
                    time: '20.00-22.00',
                    place: 'Bagus (C02)',
                    agenda: 'Ngopling (Ngopi Keliling)'
                },
                items: [
                    { topic: 'Pemasangan lampu penerangan', detail: '1. Kebutuhan lampu: 4 titik\n2. Lokasi: Depan Mas Tommy, Zulfy, Andy, P. Sapto', pic: 'Hanif', due: new Date().toISOString().split('T')[0] }
                ],
                attendees: [
                    { name: 'Hendra', address: 'C01' },
                ],
                photos: [],
                signer: {
                    ketua: 'Imam Abu Hanifah',
                    notulis_nama: 'Wicky',
                    notulis_jabatan: 'Kominfo'
                },

                // --- Zoom Logic (Tetap dipertahankan) ---

                // Hitung skala optimal. Hanya efektif di Desktop (window.innerWidth >= 1024)
                fitToScreen() {
                    const isDesktop = window.innerWidth >= 1024;
                    
                    if (isDesktop) {
                        const containerWidth = this.$refs.previewContainer.clientWidth;
                        // Beri margin aman 32px (1rem kiri, 1rem kanan padding container)
                        const availableWidth = containerWidth - 32; 
                        
                        let scale = availableWidth / this.A4_WIDTH_PX;
                        scale = Math.max(0.5, scale);
                        this.zoomLevel = Math.round(scale * 100) / 100;
                        localStorage.setItem('agv_zoom_level', this.zoomLevel);
                    } else {
                        // Di Mobile/HP, reset ke skala 1.0
                        this.zoomLevel = 1.0; 
                    }
                },

                // Fungsi untuk menambah/mengurangi zoom (Logika ini tetap dipertahankan)
                adjustZoom(delta) {
                    let newZoom = this.zoomLevel + delta;
                    
                    if (newZoom < 0.5) newZoom = 0.5;
                    if (newZoom > 2.0) newZoom = 2.0;

                    this.zoomLevel = Math.round(newZoom * 10) / 10;
                    localStorage.setItem('agv_zoom_level', this.zoomLevel);
                },
                
                // Menangani resize window untuk update zoom (Hanya Desktop)
                handleResize() {
                    if (window.innerWidth >= 1024) {
                        this.fitToScreen(); 
                    } else {
                        // Di mobile, pastikan zoom kembali ke 1.0 untuk panning yang mudah
                        this.zoomLevel = 1.0;
                    }
                },

                // --- Utility Functions ---

                formatDate(dateString) {
                    if (!dateString) return '';
                    const parts = dateString.split('-');
                    if (parts.length === 3) {
                        return `${parts[2]}/${parts[1]}/${parts[0]}`;
                    }
                    return dateString;
                },

                compressImage(file) {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            const img = new Image();
                            img.onload = () => {
                                const canvas = document.createElement('canvas');
                                let width = img.width;
                                let height = img.height;
                                const maxDim = 1200; 

                                if (width > maxDim || height > maxDim) {
                                    if (width > height) {
                                        height *= maxDim / width;
                                        width = maxDim;
                                    } else {
                                        width *= maxDim / height;
                                        height = maxDim;
                                    }
                                }
                                
                                canvas.width = width;
                                canvas.height = height;
                                const ctx = canvas.getContext('2d');
                                ctx.drawImage(img, 0, 0, width, height);

                                const dataUrl = canvas.toDataURL('image/jpeg', 0.7); 
                                resolve(dataUrl);
                            };
                            img.onerror = reject;
                            img.src = event.target.result;
                        };
                        reader.readAsDataURL(file);
                    });
                },

                // --- Core Operations (Tetap Sama) ---

                addItem() { this.items.push({ topic: '', detail: '', pic: '', due: new Date().toISOString().split('T')[0] }); },
                removeItem(i) { this.items.splice(i, 1); },
                addAttendee() { this.attendees.push({ name: '', address: '' }); },
                removeAttendee(i) { this.attendees.splice(i, 1); },

                async handlePhotos(e) {
                    const files = e.target.files;
                    if(!files) return;
                    
                    for(let i=0; i<files.length; i++){
                        try {
                            const compressedUrl = await this.compressImage(files[i]); 
                            this.photos.push(compressedUrl);
                        } catch (error) {
                            console.error("Gagal memproses foto:", error);
                            alert("Gagal memproses salah satu foto.");
                        }
                    }
                    e.target.value = ''; 
                },
                removePhoto(i) { this.photos.splice(i, 1); },

                // --- Resizer Logic (Tetap Sama) ---
                startResize(e) {
                    if (window.innerWidth < 1024) return; 

                    this.isResizing = true;
                    this.startX = e.clientX;
                    this.startWidth = this.$refs.sidebar.offsetWidth; 

                    document.body.style.userSelect = 'none';
                    document.body.style.cursor = 'ew-resize'; 
                },

                stopResize() {
                    if (this.isResizing) {
                        this.isResizing = false;
                        document.body.style.userSelect = 'auto';
                        document.body.style.cursor = 'auto';
                        localStorage.setItem('agv_sidebar_width', this.startWidth); 
                        this.fitToScreen(); 
                    }
                },

                onResize(e) {
                    if (!this.isResizing) return;

                    const deltaX = e.clientX - this.startX;
                    let newWidth = this.startWidth + deltaX;

                    const minWidth = 250;
                    const maxWidth = window.innerWidth * 0.5; 

                    if (newWidth < minWidth) newWidth = minWidth;
                    if (newWidth > maxWidth) newWidth = maxWidth;

                    document.documentElement.style.setProperty('--sidebar-width', `${newWidth}px`);
                    this.startWidth = newWidth;
                },

                // --- Storage/Draft/Import/Export & Init ---
                
                saveDraft() {
                    const data = {
                        doc: this.doc, meet: this.meet, items: this.items, attendees: this.attendees, signer: this.signer, photos: this.photos
                    };
                    try {
                        localStorage.setItem('agv_v3_draft', JSON.stringify(data));
                    } catch (e) {
                        console.warn('Gagal menyimpan foto. Data teks disimpan.');
                        localStorage.setItem('agv_v3_draft', JSON.stringify({...data, photos: []}));
                    }
                },
                
                initData() {
                    const saved = localStorage.getItem('agv_v3_draft');
                    if(saved) {
                        const p = JSON.parse(saved);
                        this.doc = p.doc || this.doc;
                        this.meet = p.meet || this.meet;
                        this.items = p.items || this.items;
                        this.attendees = p.attendees || this.attendees;
                        this.signer = p.signer || this.signer;
                        this.photos = p.photos || [];
                    }
                    
                    const savedWidth = localStorage.getItem('agv_sidebar_width');
                    if (savedWidth && window.innerWidth >= 1024) {
                        this.startWidth = parseFloat(savedWidth);
                        document.documentElement.style.setProperty('--sidebar-width', `${this.startWidth}px`);
                    } else if (window.innerWidth >= 1024) {
                        document.documentElement.style.setProperty('--sidebar-width', `${this.startWidth}px`);
                    }
                    
                    const savedZoom = localStorage.getItem('agv_zoom_level');
                    if (savedZoom) {
                         this.zoomLevel = parseFloat(savedZoom);
                    } 
                    
                    // Jika Desktop, atur zoom ke FitToScreen
                    if (window.innerWidth >= 1024) {
                        this.$nextTick(() => this.fitToScreen()); 
                    }

                    // Event Listener Global untuk Resizer
                    window.addEventListener('mousemove', (e) => this.onResize(e));
                    window.addEventListener('mouseup', () => this.stopResize());
                    
                    // Autosave Watchers
                    this.$watch('doc', () => this.saveDraft(), { deep: true });
                    this.$watch('meet', () => this.saveDraft(), { deep: true });
                    this.$watch('items', () => this.saveDraft(), { deep: true });
                    this.$watch('attendees', () => this.saveDraft(), { deep: true });
                    this.$watch('signer', () => this.saveDraft(), { deep: true });
                    this.$watch('photos', () => this.saveDraft());
                },
                
                exportData() {
                    this.saveDraft(); 
                    const dataToExport = {
                        doc: this.doc, meet: this.meet, items: this.items, attendees: this.attendees, signer: this.signer, photos: this.photos
                    };
                    const filename = `Export_Notulen_AGV_${this.meet.date}.json`;
                    const jsonString = JSON.stringify(dataToExport);
                    const blob = new Blob([jsonString], { type: 'application/json' });
                    const href = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = href;
                    link.download = filename;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(href);
                    alert('Data telah diexport sebagai file JSON.');
                },

                importData(event) {
                    const file = event.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            this.doc = importedData.doc || this.doc;
                            this.meet = importedData.meet || this.meet;
                            this.items = importedData.items || this.items;
                            this.attendees = importedData.attendees || this.attendees;
                            this.signer = importedData.signer || this.signer;
                            this.photos = importedData.photos || [];

                            this.saveDraft(); 
                            alert('Data berhasil diimport dan disimpan sebagai draft.');
                        } catch (error) {
                            alert('Gagal mengimport file. Pastikan file adalah format JSON yang benar.');
                            console.error("Import error:", error);
                        }
                    };
                    reader.readAsText(file);
                },

                generatePDF() {
                    const btn = event.target.closest('button');
                    const originalIcon = btn.innerHTML;
                    
                    btn.innerHTML = '<svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';
                    
                    if (window.innerWidth < 1024) {
                        this.activeTab = 'preview';
                    }

                    setTimeout(() => {
                        window.print();
                        btn.innerHTML = originalIcon; 
                    }, 100); 
                }
            }
        }
    </script>
</body>
</html>
